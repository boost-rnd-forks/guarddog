rules:
  - id: maven-obfuscation
    message: This package is using a common obfuscation method often used by malware
    metadata:
      description: Identify when a package uses a common obfuscation method often used by malware
    patterns:
      - pattern-either:
          # class reflection  
          - patterns: 
            - pattern-inside: | 
                $C = Class.forName("$CLASS_NAME");
                ...
            - pattern-inside: |
                $M = $C.getMethod($METHOD, ...);
                ...
            - pattern: $M.invoke(...)
            - metavariable-regex: 
                metavariable: $CLASS_NAME
                regex: (?i)(java\.lang\.(Runtime|ProcessBuilder|ClassLoader|reflect\.Method|Class|reflect\.Field|System|management\.RuntimeMXBean)|javax\.script\.ScriptEngineManager|javax\.tools\.JavaCompiler|java\.util\.Properties|java.io.File|java.nio.file.Files|java.net.Socket|HttpURLConnection|java.security.Permissions)
              
          - patterns: 
            - pattern-inside: | 
                $C = Class.forName("sun.misc.Unsafe");
                ...
            - pattern: |
                $M = $C.getMethod("...", ...);
                ...
            - pattern: $M.invoke(...)

          - pattern: | 
              $C = Class.forName($METHOD(...));
            
        
            
           
      
    languages:
      - java
    severity: WARNING

